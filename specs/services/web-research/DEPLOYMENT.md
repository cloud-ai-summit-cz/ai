# Service Deployment Plan: web-research

## Pipelines

### Build Pipeline
1. **Lint & Test**: Run ESLint and Jest unit tests.
2. **Build Artifact**: 
   - `npm run build` (Vite build).
   - Output static files to `dist/`.
3. **Docker Build**:
   - Base: `nginx:alpine`.
   - Copy `dist/` to `/usr/share/nginx/html`.
   - Copy `nginx.conf` for SPA routing (try_files).
   - Copy `env.sh` entrypoint script.
4. **Push**: Push image to Azure Container Registry (ACR).

## Environments

| Environment | Branch/Artifact | Purpose | Hosting |
| --- | --- | --- | --- |
| **Local** | Source | Development | Local Node/Vite Server |
| **Demo/Prod** | `main` / `:latest` | Live Demo | Azure Container Apps |

## Infrastructure

- **Azure Container App**:
  - **Ingress**: External, HTTP/2 enabled (for efficient SSE).
  - **Scale**: Min 1, Max 5 (HTTP scaling).
  - **Env Vars**:
    - `VITE_API_URL`: URL of the `agent-research-orchestrator`.

## Runtime Configuration (Entrypoint)
Since this is a static site served by Nginx, environment variables are injected at runtime via a `config.js` file generated by the entrypoint script.

**`env.sh`**:
```bash
#!/bin/sh
# Replaces the config.js placeholder with actual env vars
cat <<EOF > /usr/share/nginx/html/config.js
window.env = {
  API_URL: "${VITE_API_URL:-/api}"
};
EOF
exec "$@"
```
